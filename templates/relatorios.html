<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Relat√≥rios ‚Ä¢ ECC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f6f7fb; --ink:#0f172a; --muted:#64748b; --card:#ffffff; --border:#e5e7eb;
      --brand:#2563eb; --brand-600:#1e40af; --brand-50:#eff6ff; --accent:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ink);
      background:
        radial-gradient(1200px 800px at 80% -10%, #e0ebff 0%, rgba(224,235,255,0) 60%),
        radial-gradient(1000px 600px at -10% 110%, #fff3d6 0%, rgba(255,243,214,0) 60%),
        var(--bg);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:24px 16px 64px;}
    header{
      display:flex; align-items:center; gap:16px; justify-content:space-between; flex-wrap:wrap; padding:12px 0 8px;
    }
    .brand{ display:flex; align-items:center; gap:12px; }
    .logo{
      width:54px; height:54px; border-radius:50%; display:grid; place-items:center;
      background: linear-gradient(135deg, var(--brand), var(--brand-600));
      color:white; font-size:28px; box-shadow: 0 8px 24px rgba(37,99,235,.25);
    }
    .titles h1{ margin:0; font-size:22px; letter-spacing:.2px; }
    .titles p{ margin:2px 0 0; color:var(--muted); font-size:13px; }
    .stamp{
      display:flex; align-items:center; gap:10px; color:#334155; font-size:13px;
      background: var(--brand-50); border:1px solid #dbeafe; padding:8px 12px; border-radius:999px;
    }
    .stamp .dot{
      width:10px; height:10px; border-radius:999px; background: var(--accent);
      box-shadow: 0 0 0 4px rgba(245,158,11,.15);
    }

    .hero{
      margin:18px 0 8px; background:var(--card); border:1px solid var(--border); border-radius:16px; padding:22px;
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      box-shadow: 0 8px 20px rgba(15,23,42,.05);
    }
    .hero .text h2{ margin:0 0 6px; font-size:20px; }
    .hero .text p{ margin:0; color:var(--muted); font-size:14px; }
    .hero .actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{
      text-decoration:none; background:var(--brand); color:#fff; padding:10px 14px; border-radius:10px; border:1px solid var(--brand-600);
    }
    select{
      padding:8px 10px; border:1px solid var(--border); border-radius:8px; background:#fff;
    }

    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:18px; }
    canvas{ background:#fff; border:1px solid var(--border); border-radius:16px; padding:12px; }

    @media (max-width:900px){ .grid-2{ grid-template-columns:1fr; } }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1220; --card:#0f172a; --border:#1e293b; --ink:#e2e8f0; --muted:#94a3b8;
        --brand:#3b82f6; --brand-600:#1d4ed8; --brand-50:#0b255a; --accent:#fde68a;
      }
      .logo, .hero{ box-shadow:none; }
      body{
        background:
          radial-gradient(1200px 800px at 80% -10%, rgba(30,64,175,.25) 0%, rgba(30,64,175,0) 55%),
          radial-gradient(1000px 600px at -10% 110%, rgba(245,158,11,.15) 0%, rgba(245,158,11,0) 55%),
          var(--bg);
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">üïäÔ∏è</div>
        <div class="titles">
          <h1>Relat√≥rios</h1>
          <p>Par√≥quia Divino Esp√≠rito Santo ‚Äî Jati√∫ca ‚Ä¢ Arquidiocese de Macei√≥</p>
        </div>
      </div>
      <div class="stamp" title="Servi√ßo Pastoral">
        <span class="dot" aria-hidden="true"></span>
        <span>Servi√ßo √† comunidade</span>
      </div>
    </header>

    <section class="hero" role="region" aria-label="Filtros e a√ß√µes">
      <div class="text">
        <h2>Vis√£o estat√≠stica do ECC</h2>
        <p>Casais que trabalharam por ano e origem por ano de encontro.</p>
      </div>
      <div class="actions">
        <label for="anoSel" style="color:var(--muted); font-size:13px;">Ano de trabalho:</label>
        <select id="anoSel">
          {% for a in anos %}
            <option value="{{a}}">{{a}}</option>
          {% endfor %}
        </select>
        <a class="btn" href="{{ url_for('docs_index') }}" target="_blank">üñ®Ô∏è Documentos de impress√£o</a>
      </div>
    </section>

    <div class="grid-2" aria-label="Gr√°ficos de Relat√≥rios">
      <canvas id="barTrabalhos"></canvas>
      <canvas id="distAnoEncontro"></canvas>
    </div>
  </div>

<script>
let chBar, chDist;
function destroyIf(c){ if(c) c.destroy(); }

async function carregaTrabalhosPorAno(){
  const r = await fetch("/api/trabalhos_por_ano");
  const data = await r.json();
  const labels = data.map(d => d.ano);
  const valores = data.map(d => d.qtd);
  destroyIf(chBar);
  chBar = new Chart(document.getElementById("barTrabalhos"), {
    type: "bar",
    data: { labels, datasets: [{ label: "Casais que trabalharam por ano", data: valores }] },
    options: { responsive:true, maintainAspectRatio:false }
  });
}

async function carregaDistribuicaoAnoEncontro(ano){
  const r = await fetch(`/api/ano_origem_dos_trabalhadores?ano=${ano}`);
  const data = await r.json();
  const labels = data.dist.map(d => d.ano_encontro);
  const valores = data.dist.map(d => d.qtd);
  destroyIf(chDist);
  chDist = new Chart(document.getElementById("distAnoEncontro"), {
    type: "doughnut",
    data: { labels, datasets: [{ label: `Ano de encontro dos casais que trabalharam em ${ano}`, data: valores }] },
    options: { responsive:true, maintainAspectRatio:false }
  });
}

document.getElementById("anoSel").addEventListener("change", e => carregaDistribuicaoAnoEncontro(e.target.value));
window.addEventListener("DOMContentLoaded", async () => {
  await carregaTrabalhosPorAno();
  const anoIni = document.getElementById("anoSel").value;
  await carregaDistribuicaoAnoEncontro(anoIni);
});
</script>
</body>
</html>
