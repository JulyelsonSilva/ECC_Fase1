{% extends "_print_base.html" %}
{% block content %}
{% set _title = "Equipes • " ~ ano ~ (equipe and (" • " ~ equipe) or "") %}
{% set title = _title %}

<h2>Equipes • {{ ano }}{% if equipe %} • {{ equipe }}{% endif %}</h2>
<p class="muted">Coordenadores destacados.</p>

{# ===== Helpers mínimos ===== #}
{% macro proper_case(s) -%}
  {%- if s %}
    {%- set parts = s.strip().lower().split() %}
    {%- set out = [] %}
    {%- for p in parts %}
      {%- if p in ['de','da','das','do','dos','e','d','di'] and not loop.first %}
        {%- set out = out + [p] %}
      {%- else %}
        {%- set out = out + [p[:1].upper() + p[1:]] %}
      {%- endif %}
    {%- endfor %}
    {{ out|join(' ') }}
  {%- else -%}
    {{ '' }}
  {%- endif -%}
{%- endmacro %}

{% macro fmt_nome(r) -%}
  {# usa o primeiro campo existente entre ele/nome_ele/nome_usual_ele e ela/nome_ela/nome_usual_ela #}
  {% set ele = (r.ele if r.ele is defined and r.ele else
                (r.nome_ele if r.nome_ele is defined and r.nome_ele else
                 (r.nome_usual_ele if r.nome_usual_ele is defined else ''))) %}
  {% set ela = (r.ela if r.ela is defined and r.ela else
                (r.nome_ela if r.nome_ela is defined and r.nome_ela else
                 (r.nome_usual_ela if r.nome_usual_ela is defined else ''))) %}
  {{ proper_case(ele) }} &amp; {{ proper_case(ela) }}
{%- endmacro %}

{% set atual = None %}
{% for r in rows %}
  {% if not equipe and (atual != r.equipe) %}
    {% if not loop.first %}</tbody></table>{% endif %}
    <h3 style="margin:10pt 0 6pt; font-size:12.5pt;">{{ r.equipe or '—' }}</h3>
    <table>
      <thead><tr><th>Casal</th><th>Telefone(s)</th><th>Endereço</th></tr></thead>
      <tbody>
    {% set atual = r.equipe %}
  {% endif %}
  <tr>
    <td>
      {% if r.is_coord or ((r.coordenador is defined) and (r.coordenador|string|trim|lower == 'sim')) %}
        <span class="badge">Coordenador</span>
      {% endif %}
      {{ fmt_nome(r) }}
    </td>
    <td>{{ r.telefones or '' }}</td>
    <td>{{ r.endereco or '' }}</td>
  </tr>
  {% if loop.last %}</tbody></table>{% endif %}
{% endfor %}

{% if equipe and not rows|length %}
<p class="muted">Nenhum integrante encontrado para {{equipe}} em {{ano}}.</p>
{% endif %}
{% endblock %}