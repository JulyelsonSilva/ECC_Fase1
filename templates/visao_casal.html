{% extends "base.html" %}
{% block content %}
  <h2 style="text-align: center;">Visão por Casal</h2>

 <!-- Botão para voltar à página inicial -->
  <a href="{{ url_for('index') }}">
    <button type="button">Voltar para Página Inicial</button>
  </a>
  <br><br>

  <form method="get" style="text-align: center; margin-bottom: 20px;">
    <input type="text" id="nome_ele" name="nome_ele" placeholder="Nome Ele" value="{{ nome_ele }}" list="sugestoes_ele" required>
    <datalist id="sugestoes_ele"></datalist>

    <input type="text" id="nome_ela" name="nome_ela" placeholder="Nome Ela" value="{{ nome_ela }}" list="sugestoes_ela" required>
    <datalist id="sugestoes_ela"></datalist>

    <button type="submit">Buscar</button>
  </form>

  {% if erro %}
    <p style="color: red; text-align: center;">{{ erro }}</p>
  {% endif %}

  {% if dados_encontrista %}
    <div style="text-align: center; margin-bottom: 20px;">
      <h3>Dados do Encontro</h3>
      <p><strong>Ano do Encontro:</strong> {{ dados_encontrista.ano_encontro }}</p>
      <p><strong>Endereço:</strong> {{ dados_encontrista.endereco }}</p>
      <p><strong>Telefones:</strong> {{ dados_encontrista.telefones }}</p>
    </div>
  {% elif nome_ele and nome_ela %}
    <p style="text-align: center; color: red;">Casal não encontrado.</p>
  {% endif %}

  {% if dados_encontreiros %}
    <h3 style="text-align: center;">Histórico de Trabalho</h3>
    <table border="1" style="margin: auto; border-collapse: collapse;">
      <thead>
        <tr>
          <th>Ano</th>
          <th>Equipe</th>
          <th>Coordenador</th>
        </tr>
      </thead>
      <tbody>
        {% for linha in dados_encontreiros %}
          <tr>
            <td>{{ linha.ano }}</td>
            <td>{{ linha.equipe }}</td>
            <td>{{ linha.coordenador }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <script>
    const inputEle = document.getElementById('nome_ele');
    const inputEla = document.getElementById('nome_ela');
    const datalistEle = document.getElementById('sugestoes_ele');
    const datalistEla = document.getElementById('sugestoes_ela');

    function buscarNomes(input, datalist) {
      const valor = input.value;
      if (valor.length >= 3) {
        fetch(`/autocomplete-nomes?q=${valor}`)
          .then(res => res.json())
          .then(data => {
            datalist.innerHTML = "";
            data.forEach(nome => {
              const opt = document.createElement("option");
              opt.value = nome;
              datalist.appendChild(opt);
            });
          });
      }
    }

    inputEle.addEventListener("input", () => buscarNomes(inputEle, datalistEle));
    inputEla.addEventListener("input", () => buscarNomes(inputEla, datalistEla));
  </script>
{% if erro %}
  <p style="color: red; text-align: center;">{{ erro }}</p>
{% endif %}
{% endblock %}
